<?xml version="1.0" encoding="UTF-8" ?>

<container xmlns="http://symfony.com/schema/dic/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services  http://symfony.com/schema/dic/services/services-1.0.xsd">
    <services>
        <defaults autowire="false" autoconfigure="false" public="true" />

        <service id="bitbag_sylius_vue_storefront_plugin.api.user.create_user"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\CreateUserAction">
        </service>
        <service id="bitbag_sylius_vue_storefront_plugin.api.user.reset_password"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\ResetPasswordAction" />
        <service id="bitbag_sylius_vue_storefront_plugin.api.user.change_password"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\ChangePasswordAction" />
        <service id="bitbag_sylius_vue_storefront_plugin.api.user.get_order_history"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\GetOrderHistoryAction" />
        <service id="bitbag_sylius_vue_storefront_plugin.api.user.get_user"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\GetUserAction" />
        <service id="bitbag_sylius_vue_storefront_plugin.api.user.update_user"
                 class="BitBag\SyliusVueStorefrontPlugin\Controller\User\UpdateUserAction" />

        <service id="bitbag_sylius_vue_storefront_plugin.lexik_jwt_authentication.handler.authentication_success"
                 class="BitBag\SyliusVueStorefrontPlugin\Response\User\AuthenticationSuccessHandler">
            <argument type="service" id="lexik_jwt_authentication.jwt_manager" />
            <argument type="service" id="event_dispatcher" />
        </service>

        <service id="itbag_sylius_vue_storefront_plugin.listener.json_request"
                 class="BitBag\SyliusVueStorefrontPlugin\EventListener\JsonRequestListener">
            <tag name="kernel.event_listener" event="kernel.controller" method="convertJsonStringToArray" />
        </service>

        <service id="bitbag_sylius_vue_storefront_plugin.gesdinet.jwtrefreshtoken.send_token"
                 class="BitBag\SyliusVueStorefrontPlugin\EventListener\AttachRefreshTokenOnAuthenticationSuccessListener">
            <argument type="service" id="gesdinet.jwtrefreshtoken.refresh_token_manager" />
            <argument>%gesdinet_jwt_refresh_token.ttl%</argument>
            <argument type="service" id="validator" />
            <argument type="service" id="request_stack" />
            <argument>%gesdinet_jwt_refresh_token.user_identity_field%</argument>
            <argument>%gesdinet_jwt_refresh_token.single_use%</argument>

            <tag name="kernel.event_listener"
                 event="bitbag_sylius_vue_storefront_plugin.lexik_jwt_authentication.handler.authentication_success"
                 method="attachRefreshToken"
            />
        </service>
    </services>
</container>
